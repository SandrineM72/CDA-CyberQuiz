import { Question } from "../../../entities/Question";
import { Choice } from "../../../entities/Choice";
import type { Quiz } from "../../../entities/Quiz";

interface CreateMalwareQuestionsParams {
  malware_beginner_1: Quiz;
  malware_beginner_2: Quiz;
  malware_advanced_1: Quiz;
  malware_advanced_2: Quiz;
  malware_expert_1: Quiz;
  malware_expert_2: Quiz;
}

export async function createMalwareQuestions({
  malware_beginner_1,
  malware_beginner_2,
  malware_advanced_1,
  malware_advanced_2,
  malware_expert_1,
  malware_expert_2,
}: CreateMalwareQuestionsParams) {

  // ========================================
  // QUIZ 1 : Reconnaître les virus et malwares (DÉBUTANT)
  // ========================================

  const q1_1 = await Question.create({
    title: "Votre ordinateur est soudainement très lent et des fenêtres publicitaires s'ouvrent sans arrêt. Que se passe-t-il probablement ?",
    explanation: "Ces symptômes indiquent une infection par un adware (logiciel publicitaire) ou un malware. Un ordinateur propre ne ralentit pas brutalement ni n'affiche de pubs intempestives. Lancez immédiatement un scan avec votre antivirus et envisagez un logiciel anti-malware comme Malwarebytes.",
    quiz: malware_beginner_1
  }).save();

  await Choice.create({ description: "C'est normal, votre ordinateur vieillit", is_correct: false, question: q1_1 }).save();
  await Choice.create({ description: "Vous avez probablement un malware", is_correct: true, question: q1_1 }).save();
  await Choice.create({ description: "Il faut juste redémarrer l'ordinateur", is_correct: false, question: q1_1 }).save();

  const q1_2 = await Question.create({
    title: "Votre antivirus affiche une alerte 'Trojan détecté'. Que devez-vous faire ?",
    explanation: "Suivez IMMÉDIATEMENT les recommandations de votre antivirus (généralement mettre en quarantaine ou supprimer). Un Trojan (cheval de Troie) est un malware dangereux qui se fait passer pour un programme légitime. Ne l'ignorez jamais. Changez vos mots de passe importants après nettoyage car le Trojan a pu les voler.",
    quiz: malware_beginner_1
  }).save();

  await Choice.create({ description: "Ignorer, c'est une fausse alerte", is_correct: false, question: q1_2 }).save();
  await Choice.create({ description: "Suivre les recommandations de l'antivirus immédiatement", is_correct: true, question: q1_2 }).save();
  await Choice.create({ description: "Désactiver l'antivirus car il se trompe", is_correct: false, question: q1_2 }).save();

  const q1_3 = await Question.create({
    title: "Quelle est la MEILLEURE protection contre les virus ?",
    explanation: "La combinaison des trois est essentielle : un antivirus à jour détecte les menaces connues, les mises à jour système corrigent les failles de sécurité, et votre vigilance empêche les infections (ne pas cliquer sur des liens suspects, ne pas télécharger n'importe quoi). Un seul élément ne suffit pas - c'est une défense en profondeur.",
    quiz: malware_beginner_1
  }).save();

  await Choice.create({ description: "Un antivirus à jour seul suffit", is_correct: false, question: q1_3 }).save();
  await Choice.create({ description: "Antivirus + mises à jour + vigilance", is_correct: true, question: q1_3 }).save();
  await Choice.create({ description: "Ne jamais utiliser Internet", is_correct: false, question: q1_3 }).save();

  // ========================================
  // QUIZ 2 : Téléchargements sécurisés (DÉBUTANT)
  // ========================================

  const q2_1 = await Question.create({
    title: "Où devriez-vous télécharger un logiciel gratuit comme VLC ou LibreOffice ?",
    explanation: "Téléchargez TOUJOURS depuis le site officiel de l'éditeur (videolan.org pour VLC, libreoffice.org). Les sites tiers comme '01net', 'clubic' ou 'softonic' peuvent bundler (grouper) des logiciels indésirables avec votre téléchargement. En cas de doute, cherchez 'nom du logiciel + official download' sur Google.",
    quiz: malware_beginner_2
  }).save();

  await Choice.create({ description: "Sur n'importe quel site qui le propose", is_correct: false, question: q2_1 }).save();
  await Choice.create({ description: "Uniquement sur le site officiel de l'éditeur", is_correct: true, question: q2_1 }).save();
  await Choice.create({ description: "Sur le premier résultat Google", is_correct: false, question: q2_1 }).save();

  const q2_2 = await Question.create({
    title: "Lors de l'installation d'un logiciel gratuit, on vous propose d'installer aussi une barre d'outils et un antivirus 'gratuit'. Que faire ?",
    explanation: "C'est du bundling (logiciels groupés). Ces programmes supplémentaires sont souvent des adwares qui ralentissent votre ordinateur et affichent des pubs. Choisissez TOUJOURS l'installation 'Personnalisée' ou 'Avancée' et DÉCOCHEZ toutes les cases de logiciels supplémentaires. N'acceptez jamais l'installation 'Rapide' ou 'Recommandée'.",
    quiz: malware_beginner_2
  }).save();

  await Choice.create({ description: "Accepter, c'est gratuit et pratique", is_correct: false, question: q2_2 }).save();
  await Choice.create({ description: "Décocher ces options, c'est du bundling indésirable", is_correct: true, question: q2_2 }).save();
  await Choice.create({ description: "Installer rapidement sans lire", is_correct: false, question: q2_2 }).save();

  const q2_3 = await Question.create({
    title: "Vous voulez télécharger une version piratée d'un logiciel payant sur un site de torrent. Quel est le risque ?",
    explanation: "Les logiciels piratés sont une source majeure d'infection. Les pirates y cachent souvent des virus, ransomwares, keyloggers ou crypto-miners. Même si le crack 'fonctionne', vous donnez potentiellement accès à toutes vos données. Le risque est énorme : vol d'identité, chantage, destruction de données. Utilisez des alternatives gratuites légales plutôt.",
    quiz: malware_beginner_2
  }).save();

  await Choice.create({ description: "Aucun risque si le site est connu", is_correct: false, question: q2_3 }).save();
  await Choice.create({ description: "Très haut risque de malware et virus", is_correct: true, question: q2_3 }).save();
  await Choice.create({ description: "Risque faible si vous avez un antivirus", is_correct: false, question: q2_3 }).save();

  // ========================================
  // QUIZ 3 : Ransomwares - comprendre et prévenir (AVANCÉ)
  // ========================================

  const q3_1 = await Question.create({
    title: "Un ransomware chiffre vos fichiers et demande une rançon. Quelle est la MEILLEURE défense préventive ?",
    explanation: "La règle 3-2-1 : 3 copies de vos données, sur 2 supports différents (disque dur externe + cloud), dont 1 hors ligne (déconnecté). Si un ransomware chiffre votre ordinateur, vous restaurez simplement depuis votre sauvegarde. Les antivirus aident mais ne garantissent rien. Ne payez JAMAIS la rançon - ça finance les criminels et ne garantit pas la récupération.",
    quiz: malware_advanced_1
  }).save();

  await Choice.create({ description: "Avoir un très bon antivirus", is_correct: false, question: q3_1 }).save();
  await Choice.create({ description: "Sauvegardes régulières hors ligne (règle 3-2-1)", is_correct: true, question: q3_1 }).save();
  await Choice.create({ description: "Payer rapidement la rançon si infecté", is_correct: false, question: q3_1 }).save();

  const q3_2 = await Question.create({
    title: "Vos fichiers sont chiffrés par un ransomware. Devriez-vous payer la rançon ?",
    explanation: "NON, ne payez jamais ! Statistiquement, 40% des victimes qui paient ne récupèrent pas leurs fichiers. Vous financez le crime organisé. De plus, payer vous marque comme une 'bonne cible' pour de futures attaques. Contactez la police, vérifiez sur NoMoreRansom.org si un déchiffreur existe, et restaurez depuis vos sauvegardes si possible.",
    quiz: malware_advanced_1
  }).save();

  await Choice.create({ description: "Oui, c'est le seul moyen de récupérer vos fichiers", is_correct: false, question: q3_2 }).save();
  await Choice.create({ description: "Non, ça finance les criminels sans garantie", is_correct: true, question: q3_2 }).save();
  await Choice.create({ description: "Oui, si c'est urgent et important", is_correct: false, question: q3_2 }).save();

  const q3_3 = await Question.create({
    title: "Comment les ransomwares se propagent-ils le plus souvent ?",
    explanation: "La majorité des infections ransomware proviennent d'emails de phishing avec pièces jointes malveillantes (.exe, .zip, macros Office) ou liens vers des sites piégés. Les exploits RDP (Bureau à distance) mal sécurisés sont aussi courants en entreprise. Méfiez-vous des emails urgents avec pièces jointes, même s'ils semblent provenir de contacts connus.",
    quiz: malware_advanced_1
  }).save();

  await Choice.create({ description: "Par des sites web normaux en naviguant", is_correct: false, question: q3_3 }).save();
  await Choice.create({ description: "Emails de phishing avec pièces jointes malveillantes", is_correct: true, question: q3_3 }).save();
  await Choice.create({ description: "En installant des mises à jour Windows", is_correct: false, question: q3_3 }).save();

  // ========================================
  // QUIZ 4 : Trojans et spywares (AVANCÉ)
  // ========================================

  const q4_1 = await Question.create({
    title: "Quelle est la différence entre un virus et un cheval de Troie (Trojan) ?",
    explanation: "Un virus se réplique et se propage automatiquement en infectant d'autres fichiers. Un Trojan se déguise en programme légitime mais ne se réplique pas seul - il attend que VOUS l'exécutiez. Exemple : un 'crack' de logiciel qui est en fait un Trojan. Une fois lancé, il ouvre une porte dérobée, vole des données, ou télécharge d'autres malwares.",
    quiz: malware_advanced_2
  }).save();

  await Choice.create({ description: "Un virus se réplique, un Trojan se déguise", is_correct: true, question: q4_1 }).save();
  await Choice.create({ description: "Il n'y a aucune différence", is_correct: false, question: q4_1 }).save();
  await Choice.create({ description: "Un virus est plus dangereux", is_correct: false, question: q4_1 }).save();

  const q4_2 = await Question.create({
    title: "Un spyware (logiciel espion) installé sur votre ordinateur peut faire quoi ?",
    explanation: "Un spyware surveille et enregistre TOUT ce que vous faites : sites visités, frappes clavier (keylogger), captures d'écran, webcam, micro, mots de passe, messages, fichiers. Il envoie ces données à l'attaquant. Certains spywares commerciaux (stalkerware) sont même vendus légalement pour 'surveiller les employés' mais utilisés pour harceler.",
    quiz: malware_advanced_2
  }).save();

  await Choice.create({ description: "Enregistrer vos frappes clavier et captures d'écran", is_correct: true, question: q4_2 }).save();
  await Choice.create({ description: "Seulement ralentir votre ordinateur", is_correct: false, question: q4_2 }).save();
  await Choice.create({ description: "Afficher des publicités", is_correct: false, question: q4_2 }).save();

  const q4_3 = await Question.create({
    title: "Vous téléchargez un 'générateur de clés' (keygen) pour activer un logiciel. Pourquoi est-ce dangereux ?",
    explanation: "Les keygens sont presque TOUJOURS des Trojans. L'antivirus les détecte souvent, mais les utilisateurs désactivent l'antivirus en pensant que c'est une 'fausse alerte'. Le keygen peut installer un backdoor (porte dérobée), un crypto-miner qui utilise votre processeur pour miner de la cryptomonnaie, ou un infostealer qui vole tous vos mots de passe.",
    quiz: malware_advanced_2
  }).save();

  await Choice.create({ description: "Les keygens contiennent presque toujours des Trojans", is_correct: true, question: q4_3 }).save();
  await Choice.create({ description: "Ce n'est pas dangereux, c'est juste interdit", is_correct: false, question: q4_3 }).save();
  await Choice.create({ description: "C'est sans risque si l'antivirus est désactivé", is_correct: false, question: q4_3 }).save();

  // ========================================
  // QUIZ 5 : APT et menaces persistantes (EXPERT)
  // ========================================

  const q5_1 = await Question.create({
    title: "Qu'est-ce qu'une APT (Advanced Persistent Threat) ?",
    explanation: "Une APT est une attaque ciblée, sophistiquée et de longue durée menée par des groupes organisés (souvent soutenus par des États). Ils infiltrent un réseau, restent cachés pendant des mois/années, volent des données sensibles discrètement. Contrairement aux attaques opportunistes, l'APT vise spécifiquement VOTRE organisation avec des ressources importantes. Exemples : APT28 (Russie), APT29 (Cozy Bear).",
    quiz: malware_expert_1
  }).save();

  await Choice.create({ description: "Une attaque ciblée, sophistiquée et persistante", is_correct: true, question: q5_1 }).save();
  await Choice.create({ description: "Un virus qui se propage très vite", is_correct: false, question: q5_1 }).save();
  await Choice.create({ description: "Un logiciel de protection avancé", is_correct: false, question: q5_1 }).save();

  const q5_2 = await Question.create({
    title: "Comment une APT maintient-elle sa présence dans un réseau compromis ?",
    explanation: "Les APT utilisent plusieurs backdoors (portes dérobées) à différents endroits du réseau, des comptes dormants, des implants dans le firmware, et du lateral movement (déplacement latéral) entre machines. Si un point d'accès est découvert, ils en ont d'autres. Ils camouflent leur trafic en imitant le trafic légitime. La détection nécessite des outils EDR avancés et du threat hunting proactif.",
    quiz: malware_expert_1
  }).save();

  await Choice.create({ description: "Multiples backdoors et déplacement latéral", is_correct: true, question: q5_2 }).save();
  await Choice.create({ description: "En redémarrant l'ordinateur régulièrement", is_correct: false, question: q5_2 }).save();
  await Choice.create({ description: "En se cachant dans les fichiers temporaires", is_correct: false, question: q5_2 }).save();

  const q5_3 = await Question.create({
    title: "Quelle technique une APT utilise-t-elle pour exfiltrer des données sans se faire détecter ?",
    explanation: "Le DNS tunneling encode les données dans des requêtes DNS qui semblent normales. Le HTTPS tunneling cache les données dans du trafic web chiffré normal. Le steganography cache des données dans des images. L'exfiltration lente (slow exfil) envoie de petites quantités sur une longue période. Les APT combinent plusieurs techniques et utilisent des serveurs compromis légitimes comme relais.",
    quiz: malware_expert_1
  }).save();

  await Choice.create({ description: "DNS tunneling et exfiltration lente", is_correct: true, question: q5_3 }).save();
  await Choice.create({ description: "Téléchargement direct FTP", is_correct: false, question: q5_3 }).save();
  await Choice.create({ description: "Envoi par email non chiffré", is_correct: false, question: q5_3 }).save();

  // ========================================
  // QUIZ 6 : Zero-day et exploits avancés (EXPERT)
  // ========================================

  const q6_1 = await Question.create({
    title: "Qu'est-ce qu'une vulnérabilité zero-day ?",
    explanation: "Une vulnérabilité zero-day est une faille de sécurité inconnue de l'éditeur du logiciel. 'Zero-day' signifie que l'éditeur a eu ZÉRO jour pour la corriger avant qu'elle soit exploitée. Ces failles sont très précieuses - vendues sur le marché noir entre 100k$ et plusieurs millions. Les États, agences de renseignement, et cybercriminels les achètent pour mener des attaques ciblées.",
    quiz: malware_expert_2
  }).save();

  await Choice.create({ description: "Une faille inconnue de l'éditeur du logiciel", is_correct: true, question: q6_1 }).save();
  await Choice.create({ description: "Un virus qui s'active à minuit", is_correct: false, question: q6_1 }).save();
  await Choice.create({ description: "Un logiciel gratuit pendant un jour", is_correct: false, question: q6_1 }).save();

  const q6_2 = await Question.create({
    title: "Pourquoi est-il presque impossible de se protéger d'une attaque zero-day avec un antivirus classique ?",
    explanation: "Les antivirus traditionnels utilisent des signatures (empreintes) de malwares connus. Par définition, un zero-day est INCONNU - il n'a pas de signature. Seules les défenses comportementales (EDR, sandboxing, analyse heuristique) peuvent détecter des comportements suspects même pour des malwares inconnus. C'est pourquoi les mises à jour système sont critiques : elles corrigent les failles avant exploitation.",
    quiz: malware_expert_2
  }).save();

  await Choice.create({ description: "Les antivirus détectent par signature, pas les menaces inconnues", is_correct: true, question: q6_2 }).save();
  await Choice.create({ description: "Les antivirus peuvent tout détecter avec l'IA", is_correct: false, question: q6_2 }).save();
  await Choice.create({ description: "C'est facile avec un bon antivirus payant", is_correct: false, question: q6_2 }).save();

  const q6_3 = await Question.create({
    title: "Qu'est-ce qu'un 'exploit kit' et comment fonctionne-t-il ?",
    explanation: "Un exploit kit est une plateforme clé-en-main qui automatise l'exploitation de vulnérabilités. Quand vous visitez un site compromis, l'exploit kit scanne votre navigateur/plugins pour détecter des versions vulnérables (Flash, Java, PDF). Il lance alors automatiquement l'exploit correspondant pour installer un malware. Les kits comme Angler, RIG ou Magnitude sont loués sur le darknet. Protection : mises à jour automatiques activées !",
    quiz: malware_expert_2
  }).save();

  await Choice.create({ description: "Une plateforme automatisant l'exploitation de failles", is_correct: true, question: q6_3 }).save();
  await Choice.create({ description: "Un logiciel pour créer des virus", is_correct: false, question: q6_3 }).save();
  await Choice.create({ description: "Un kit de réparation pour ordinateurs", is_correct: false, question: q6_3 }).save();

  console.log("✅ Questions Malwares créées avec succès");
}
